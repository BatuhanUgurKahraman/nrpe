###############################
# Makefile for NRPE
#
# Last Modified: 03-14-2007
###############################


# Source code directories
SRC_BASE=./src/
SRC_INCLUDE=./include/

CC=@CC@
CFLAGS=@CFLAGS@ @DEFS@
LDFLAGS=@LDFLAGS@ @LIBS@

prefix=@prefix@
exec_prefix=@exec_prefix@
CFGDIR=@pkgsysconfdir@
BINDIR=@bindir@
SBINDIR=@sbindir@
LIBEXECDIR=@libexecdir@
INSTALL=@INSTALL@
NAGIOS_INSTALL_OPTS=@NAGIOS_INSTALL_OPTS@
NRPE_INSTALL_OPTS=@NRPE_INSTALL_OPTS@

INIT_DIR=@initdir@
INIT_OPTS=-o root -g root
INIT_FILE=@initname@
INETD_DIR=@inetddir@
INETD_FILE=@inetdname@
SRC_INETD=@src_inetd@
SRC_INIT=@src_init@


all:
	cd $(SRC_BASE); $(MAKE); cd ..

	@echo ""
	@echo "*** Compile finished ***"
	@echo ""
	@echo "If the NRPE daemon and client compiled without any errors, you"
	@echo "can continue with the installation or upgrade process."
	@echo ""
	@echo "Read the PDF documentation (NRPE.pdf) for information on the next"
	@echo "steps you should take to complete the installation or upgrade."
	@echo ""

nrpe:
	cd $(SRC_BASE); $(MAKE); cd ..

check_nrpe:
	cd $(SRC_BASE); $(MAKE); cd ..

install-plugin:
	cd $(SRC_BASE); $(MAKE) $@; cd ..

install-daemon:
	cd $(SRC_BASE); $(MAKE) $@; cd ..

install:

install-inetd:
	@if test $(SRC_INETD) = unknown; then \
		echo No inetd file to install; \
		exit 1; \
	fi
	$(INSTALL) -m 644 startup/$(SRC_INETD) $(INETD_DIR)/$(INETD_FILE)

install-init:
	@if test $(SRC_INIT) = unknown; then \
		echo No init file to install; \
		exit 1; \
	fi
	$(INSTALL) -m 644 startup/$(SRC_INIT) $(INIT_DIR)/$(INIT_FILE)

install-config:
	$(INSTALL) -m 775 $(NAGIOS_INSTALL_OPTS) -d $(CFGDIR)
	$(INSTALL) -m 644 $(NRPE_INSTALL_OPTS) sample-config/nrpe.cfg $(CFGDIR)

solaris-package:
	@if [ `uname -s` != "SunOS" ] ; then \
		echo "It is recommended you be running on Solaris to build a Solaris package"; \
	else \
		cd package/solaris; $(MAKE) build ; $(MAKE) pkg ; cd ../..; \
	fi

clean:
	cd $(SRC_BASE); $(MAKE) $@; cd ..
	cd package/solaris; $(MAKE) $@; cd ../..
	rm -f core
	rm -f *~ */*~

distclean: clean
	cd $(SRC_BASE); $(MAKE) $@; cd ..
	cd package/solaris; $(MAKE) $@; cd ../..
	rm -f config.log config.status config.cache nrpe.cfg nrpe.xinetd subst $(SRC_INCLUDE)/config.h init-script init-script.debian init-script.freebsd init-script.suse
	rm -f sample-config/*.cfg sample-config/*.xinetd
	rm -f Makefile

devclean: distclean

